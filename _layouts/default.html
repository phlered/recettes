---
# Ce layout surcharge minima pour permettre le mode sombre, un header personnalis√© et un fond visuel.
layout: null
---

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }}</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçΩÔ∏è</text></svg>">
    <link rel="stylesheet" href="{{ '/assets/main.css' | relative_url }}">
  </head>
  <body class="{{ page.layout | default: '' }} {{ page.title | slugify }} {% if page.collection == 'recettes' %}recette-page{% endif %}">
    <header class="site-header">
      <div class="header-content">
        <a href="{{ '/' | relative_url }}" class="logo-btn" aria-label="Retour √† l'accueil">
          <span class="logo-icon" aria-hidden="true">üè†</span>
          <span class="logo-text">Mes recettes</span>
        </a>
        <div class="search-bar" id="searchBar">
          <input type="text" id="headerSearchInput" placeholder="Rechercher une recette..." />
          <button type="button" id="clearSearchBtn" aria-label="Effacer la recherche">‚úñ</button>
        </div>
        <div class="recipe-nav" id="recipeNav" style="display: none;">
          <button type="button" id="prevRecipeBtn" class="nav-btn nav-prev" aria-label="Recette pr√©c√©dente">‚Üê</button>
          <span id="navCounter" class="nav-counter"></span>
          <button type="button" id="nextRecipeBtn" class="nav-btn nav-next" aria-label="Recette suivante">‚Üí</button>
        </div>
      </div>
    </header>
    <main class="site-main recette-main">
      {{ content }}
    </main>
    
    <script>
    (function() {
      const searchInput = document.getElementById("headerSearchInput");
      const clearBtn = document.getElementById("clearSearchBtn");
      const recetteCards = document.getElementById("recetteCards");
      const recettesTitle = document.getElementById("recettes-title");
      const searchBar = document.getElementById("searchBar");
      const recipeNav = document.getElementById("recipeNav");
      const prevBtn = document.getElementById("prevRecipeBtn");
      const nextBtn = document.getElementById("nextRecipeBtn");
      const navCounter = document.getElementById("navCounter");
      
      const isRecipePage = document.body.classList.contains('recette-page');
      const isHomePage = !isRecipePage;
      
      // ===== Gestion de l'historique des recettes =====
      function getRecipeHistory() {
        const stored = localStorage.getItem('recipeHistory');
        return stored ? JSON.parse(stored) : [];
      }
      
      function saveRecipeHistory(history) {
        localStorage.setItem('recipeHistory', JSON.stringify(history));
      }
      
      function addToHistory(url, title) {
        let history = getRecipeHistory();
        // √âviter les doublons cons√©cutifs
        if (history.length > 0 && history[history.length - 1].url === url) {
          return;
        }
        history.push({ url, title, timestamp: Date.now() });
        // Garder seulement les 20 derni√®res recettes
        if (history.length > 20) {
          history = history.slice(-20);
        }
        saveRecipeHistory(history);
        updateNavigation();
      }
      
      function getCurrentRecipeIndex() {
        const currentUrl = window.location.pathname;
        const history = getRecipeHistory();
        return history.findIndex(r => r.url === currentUrl);
      }
      
      function updateNavigation() {
        const history = getRecipeHistory();
        const currentIndex = getCurrentRecipeIndex();
        
        if (currentIndex === -1 || history.length === 0) {
          recipeNav.style.display = 'none';
          return;
        }
        
        recipeNav.style.display = 'flex';
        navCounter.textContent = `${currentIndex + 1}/${history.length}`;
        
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === history.length - 1;
      }
      
      function navigateRecipe(direction) {
        const history = getRecipeHistory();
        const currentIndex = getCurrentRecipeIndex();
        
        if (currentIndex === -1) return;
        
        let newIndex = currentIndex + direction;
        if (newIndex >= 0 && newIndex < history.length) {
          window.location.href = history[newIndex].url;
        }
      }
      
      // Si on est sur une page de recette, l'ajouter √† l'historique et initialiser la nav
      if (isRecipePage) {
        const pageTitle = document.querySelector('h1')?.textContent || document.title;
        addToHistory(window.location.pathname, pageTitle);
        updateNavigation();
        
        prevBtn.addEventListener('click', () => navigateRecipe(-1));
        nextBtn.addEventListener('click', () => navigateRecipe(1));
      }
      
      // ===== Gestion de la barre de recherche (page d'accueil seulement) =====
      function debounce(fn, delay) {
        let timer = null;
        return (...args) => {
          clearTimeout(timer);
          timer = setTimeout(() => fn(...args), delay);
        };
      }
      
      function filterRecipes() {
        if (!recetteCards) return; // Pas sur la page d'accueil
        
        const q = searchInput.value.toLowerCase().trim();
        const cards = recetteCards.querySelectorAll('.recette-card');
        let visibleCount = 0;
        
        if (q === "") {
          // Afficher toutes les cartes
          cards.forEach(card => {
            card.style.display = '';
          });
          if (recettesTitle) recettesTitle.textContent = 'Toutes mes recettes';
          if (clearBtn) clearBtn.style.display = 'none';
          return;
        }
        
        // Filtrer les cartes
        cards.forEach(card => {
          const title = card.dataset.title || '';
          const tags = card.dataset.tags || '';
          const content = card.dataset.content || '';
          
          if (title.includes(q) || tags.includes(q) || content.includes(q)) {
            card.style.display = '';
            visibleCount++;
          } else {
            card.style.display = 'none';
          }
        });
        
        // Mettre √† jour le titre
        if (recettesTitle) {
          if (visibleCount === 0) {
            recettesTitle.textContent = 'Aucune recette trouv√©e';
          } else if (visibleCount === 1) {
            recettesTitle.textContent = '1 recette trouv√©e';
          } else {
            recettesTitle.textContent = `${visibleCount} recettes trouv√©es`;
          }
        }
        
        if (clearBtn) clearBtn.style.display = 'flex';
      }
      
      function clearSearch() {
        searchInput.value = '';
        filterRecipes();
        searchInput.focus();
      }
      
      if (isHomePage) {
        if (searchInput) {
          searchInput.addEventListener("input", debounce(filterRecipes, 200));
        }
        
        if (clearBtn) {
          clearBtn.addEventListener("click", clearSearch);
          clearBtn.style.display = 'none'; // Cach√© par d√©faut
        }
      }
    })();
    </script>
    {% include footer.html %}
  </body>
</html>
